#!/usr/bin/env bash
set -euo pipefail

host="${PLOY_TRADING_HOST:-}"
if [[ -z "$host" ]]; then
  echo "PLOY_TRADING_HOST is required (example: ploy@1.2.3.4)" >&2
  exit 2
fi

ssh_opts=()
if [[ -n "${PLOY_TRADING_SSH_OPTS:-}" ]]; then
  # shellcheck disable=SC2206
  ssh_opts+=(${PLOY_TRADING_SSH_OPTS})
fi

cmd="${1:-}"
shift || true

case "$cmd" in
  status|stop|rpc)
    exec ssh "${ssh_opts[@]}" "$host" "$cmd" "$@"
    ;;
  start)
    # start <trade> <dry_run>
    exec ssh "${ssh_opts[@]}" "$host" "$cmd" "$@"
    ;;
  logs)
    exec ssh "${ssh_opts[@]}" "$host" "$cmd" "$@"
    ;;
  ""|-h|--help|help)
    echo "Usage: ployctl status|start|stop|logs|rpc" >&2
    exit 2
    ;;
  *)
    echo "Unsupported subcommand: $cmd" >&2
    exit 2
    ;;
esac

