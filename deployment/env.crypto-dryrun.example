# Crypto dry-run workload environment
# Copy to: /opt/ploy/env/crypto-dryrun.env

# Optional for dry-run; required for live order placement.
# Recommended: set this in `/opt/ploy/.env` if/when you go live.
# POLYMARKET_PRIVATE_KEY=0x...

# Safety default
PLOY_DRY_RUN__ENABLED=true
PLOY_RUN_SQLX_MIGRATIONS=true
PLOY_REQUIRE_SQLX_MIGRATIONS=true
PLOY_COORDINATOR__HEARTBEAT_STALE_WARN_COOLDOWN_SECS=300
PLOY_DEPLOYMENTS_FILE=/opt/ploy/data/state/deployments.json

# OpenClaw-first control plane (optional)
# PLOY_AGENT_FRAMEWORK__MODE=openclaw
# PLOY_AGENT_FRAMEWORK__HARD_DISABLE_INTERNAL_AGENTS=true

# Single DB multi-account scope
PLOY_ACCOUNT__ID=default

# CLOB quote persistence uses this database.
# Keep the same value as /opt/ploy/env/sports-pm.env when running both workloads.
PLOY_DATABASE__URL=postgres://ploy:CHANGE_ME@127.0.0.1:5432/ploy

# Optional: crypto-agent behavior overrides for platform mode.
# If unset, values come from /opt/ploy/config/crypto_dry_run.toml [strategy]/[risk].
# PLOY_CRYPTO_AGENT__ENABLED=true
# PLOY_CRYPTO_AGENT__COINS=BTC,ETH,SOL,XRP
# PLOY_CRYPTO_AGENT__DEFAULT_SHARES=20
# PLOY_CRYPTO_AGENT__SUM_THRESHOLD=0.965
# PLOY_CRYPTO_AGENT__MIN_MOMENTUM_1S=0.001
# PLOY_CRYPTO_AGENT__EVENT_REFRESH_SECS=30
# PLOY_CRYPTO_AGENT__MIN_TIME_REMAINING_SECS=60
# PLOY_CRYPTO_AGENT__MAX_TIME_REMAINING_SECS=900
# PLOY_CRYPTO_AGENT__PREFER_CLOSE_TO_END=true
# Binary-option exits (preferred names)
# PLOY_CRYPTO_AGENT__EXIT_EDGE_FLOOR=0.02
# PLOY_CRYPTO_AGENT__EXIT_PRICE_BAND=0.05
# PLOY_CRYPTO_AGENT__MAX_ORDER_VALUE_USD=100
# PLOY_CRYPTO_AGENT__MAX_TOTAL_EXPOSURE_USD=300
# PLOY_CRYPTO_AGENT__MAX_DAILY_LOSS_USD=500
# PLOY_CRYPTO_AGENT__MAX_UNHEDGED_POSITIONS=1

# Optional: Binance LOB (order book) depth collector for ML/RL feature generation.
# Enable if you want to record order-book distributions and compute LOB-derived features.
# PLOY_BINANCE_LOB__ENABLED=true
# PLOY_BINANCE_LOB__SYMBOLS=BTCUSDT,ETHUSDT
# BN_LOB_SNAPSHOT_MS=1000
# BN_LOB_LEVELS=20

# Optional: second crypto strategy — LOB+ML probability model (model-first).
# This runs as a separate agent (`agent_id=crypto_lob_ml`) under the same coordinator.
# PLOY_CRYPTO_LOB_ML__ENABLED=true
# PLOY_CRYPTO_LOB_ML__COINS=BTC,ETH,SOL,XRP
# PLOY_CRYPTO_LOB_ML__DEFAULT_SHARES=50
# PLOY_CRYPTO_LOB_ML__MIN_EDGE=0.02
# PLOY_CRYPTO_LOB_ML__MAX_ENTRY_PRICE=0.70
# PLOY_CRYPTO_LOB_ML__EVENT_REFRESH_SECS=15
# PLOY_CRYPTO_LOB_ML__MIN_TIME_REMAINING_SECS=60
# PLOY_CRYPTO_LOB_ML__MAX_TIME_REMAINING_SECS=900
# PLOY_CRYPTO_LOB_ML__PREFER_CLOSE_TO_END=true
# PLOY_CRYPTO_LOB_ML__COOLDOWN_SECS=30
# PLOY_CRYPTO_LOB_ML__MAX_LOB_SNAPSHOT_AGE_SECS=2
# Model selection (required for live inference):
# - onnx only (requires building binary with --features onnx)
# - if model path is missing/invalid, crypto_lob_ml startup fails (no heuristic fallback)
# PLOY_CRYPTO_LOB_ML__MODEL_TYPE=onnx
# PLOY_CRYPTO_LOB_ML__MODEL_PATH=/opt/ploy/models/crypto/lob_tcn_v1.onnx
# PLOY_CRYPTO_LOB_ML__MODEL_VERSION=lob_tcn_v1
# Exit mode (choose one):
# - settle_only: hold until settlement
# - ev_exit: exit when model EV turns negative (pure model-driven)
# - signal_flip: exit when model side flips
# - price_exit: exit on mark-to-market stop/take thresholds
# PLOY_CRYPTO_LOB_ML__EXIT_MODE=ev_exit
# Safety fallback weight for p_up_window baseline (model-first blend).
# p_up = p_up_model * (1 - w) + p_up_window * w
# PLOY_CRYPTO_LOB_ML__WINDOW_FALLBACK_WEIGHT=0.10
# Binary-option net EV cost model (used in YES/NO side selection):
# PLOY_CRYPTO_LOB_ML__TAKER_FEE_RATE=0.02
# PLOY_CRYPTO_LOB_ML__ENTRY_SLIPPAGE_BPS=10
# Price-to-beat aware settlement probability anchor:
# PLOY_CRYPTO_LOB_ML__USE_PRICE_TO_BEAT=true
# PLOY_CRYPTO_LOB_ML__REQUIRE_PRICE_TO_BEAT=true
# PLOY_CRYPTO_LOB_ML__THRESHOLD_PROB_WEIGHT=0.35
# Binary-option exits (preferred names)
# PLOY_CRYPTO_LOB_ML__EXIT_EDGE_FLOOR=0.02
# PLOY_CRYPTO_LOB_ML__EXIT_PRICE_BAND=0.05

# Optional: third crypto strategy — RL policy (ONNX) controlling order actions.
# Runs as a separate agent (`agent_id=crypto_rl_policy`) under the same coordinator.
# Recommended: disable the baseline momentum agent when testing RL only:
# PLOY_CRYPTO_AGENT__ENABLED=false
# PLOY_CRYPTO_RL_POLICY__ENABLED=true
# PLOY_CRYPTO_RL_POLICY__COINS=BTC,ETH,SOL,XRP
# PLOY_CRYPTO_RL_POLICY__DEFAULT_SHARES=50
# PLOY_CRYPTO_RL_POLICY__MAX_ENTRY_PRICE=0.70
# PLOY_CRYPTO_RL_POLICY__EVENT_REFRESH_SECS=15
# PLOY_CRYPTO_RL_POLICY__MIN_TIME_REMAINING_SECS=60
# PLOY_CRYPTO_RL_POLICY__MAX_TIME_REMAINING_SECS=900
# PLOY_CRYPTO_RL_POLICY__PREFER_CLOSE_TO_END=true
# PLOY_CRYPTO_RL_POLICY__COOLDOWN_SECS=10
# PLOY_CRYPTO_RL_POLICY__MAX_LOB_SNAPSHOT_AGE_SECS=2
# PLOY_CRYPTO_RL_POLICY__DECISION_INTERVAL_MS=1000
# PLOY_CRYPTO_RL_POLICY__EXPLORATION_RATE=0.0
# Observation schema version (affects ONNX input dim):
# - 1: 25 dims (baseline)
# - 2: 31 dims (adds more Binance OBI features)
# PLOY_CRYPTO_RL_POLICY__OBS_VERSION=2
# ONNX policy model (requires building binary with --features onnx):
# PLOY_CRYPTO_RL_POLICY__MODEL_PATH=/opt/ploy/models/crypto/rl_policy_v1.onnx
# PLOY_CRYPTO_RL_POLICY__POLICY_OUTPUT=continuous
# PLOY_CRYPTO_RL_POLICY__MODEL_VERSION=rl_policy_v1

# Optional: coordinator-level duplicate guard + capital allocator (recommended in production).
# Duplicate guard: block repeated same-side buy intents in a short window.
PLOY_COORDINATOR__DUPLICATE_GUARD_ENABLED=true
PLOY_COORDINATOR__DUPLICATE_GUARD_WINDOW_MS=60000
#
# Coordinator-level sizing: Kelly (conservative, opt-in).
# Requires strategies to emit `signal_fair_value` (p) metadata.
PLOY_COORDINATOR__KELLY_SIZING_ENABLED=true
PLOY_COORDINATOR__KELLY_FRACTION_MULTIPLIER=0.25
PLOY_COORDINATOR__KELLY_MIN_EDGE=0
#
# Account-level risk budget (shared policy across crypto + sports services):
# - Keep a cash reserve and avoid deploying 100% capital.
# - Split deployable budget as crypto=2/3, sports=1/3.
PLOY_RISK__ACCOUNT_RESERVE_PCT=0.15
PLOY_RISK__CRYPTO_ALLOCATION_PCT=0.6667
PLOY_RISK__SPORTS_ALLOCATION_PCT=0.3333
PLOY_RISK__CIRCUIT_BREAKER_AUTO_RECOVER=true
PLOY_RISK__CIRCUIT_BREAKER_COOLDOWN_SECS=300
#
# Capital allocator: conservative profile (prefer 15m exposure, limit 5m).
PLOY_COORDINATOR__CRYPTO_ALLOCATOR_ENABLED=true
PLOY_COORDINATOR__CRYPTO_ALLOCATOR_TOTAL_CAP_USD=100
PLOY_COORDINATOR__CRYPTO_COIN_CAP_BTC_PCT=0.40
PLOY_COORDINATOR__CRYPTO_COIN_CAP_ETH_PCT=0.30
PLOY_COORDINATOR__CRYPTO_COIN_CAP_SOL_PCT=0.20
PLOY_COORDINATOR__CRYPTO_COIN_CAP_XRP_PCT=0.12
PLOY_COORDINATOR__CRYPTO_COIN_CAP_OTHER_PCT=0.10
PLOY_COORDINATOR__CRYPTO_HORIZON_CAP_5M_PCT=0.25
PLOY_COORDINATOR__CRYPTO_HORIZON_CAP_15M_PCT=0.65
PLOY_COORDINATOR__CRYPTO_HORIZON_CAP_OTHER_PCT=0.20

# Polymarket trade tape collector (tick-by-tick executed volume)
# Tuning:
PM_TRADES_POLL_SECS=10
PM_TRADES_PAGE_LIMIT=200
PM_TRADES_MAX_PAGES=10
PM_TRADES_OVERLAP_SECS=120
PM_TRADES_CONCURRENCY=4

# Optional: trade alerts (set thresholds > 0 to enable DB-backed alerts + logs)
# Single-print alerts
PM_TRADE_ALERT_MIN_SIZE=0
PM_TRADE_ALERT_MIN_NOTIONAL=0
# Burst alerts (rolling window + cooldown bucket)
PM_TRADE_BURST_WINDOW_SECS=60
PM_TRADE_BURST_MIN_SIZE=0
PM_TRADE_BURST_MIN_NOTIONAL=0
PM_TRADE_BURST_MIN_TRADES=0
PM_TRADE_BURST_COOLDOWN_SECS=60

# Optional: Polymarket orderbook-history (L2) backfill collector
# Runs as: systemd unit `ploy-orderbook-history` (bash wrapper)
# Defaults are applied by the wrapper script; uncomment to tune.
# PLOY_ORDERBOOK_HISTORY_CONFIG=/opt/ploy/config/crypto_dry_run.toml
# PLOY_ORDERBOOK_HISTORY_LOOKBACK_SECS=900
# PLOY_ORDERBOOK_HISTORY_LEVELS=20
# PLOY_ORDERBOOK_HISTORY_SAMPLE_MS=1000
# PLOY_ORDERBOOK_HISTORY_LIMIT=500
# PLOY_ORDERBOOK_HISTORY_MAX_PAGES=5
# PLOY_ORDERBOOK_HISTORY_SLEEP_SECS=60
# PLOY_ORDERBOOK_HISTORY_TOKEN_WINDOW_MINS=30
# PLOY_ORDERBOOK_HISTORY_TOKEN_LIMIT=50
# Optional safety net: fallback to clob_quote_ticks if collector_token_targets is empty.
# Keep false to enforce "crypto + today NBA only".
# PLOY_ORDERBOOK_HISTORY_FALLBACK_ACTIVE_TICKS=false

# Logging
RUST_LOG=info,ploy=info,sqlx=warn
